<!doctype html>
<html class="no-js">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />
<link rel="index" title="Index" href="genindex.html" /><link rel="search" title="Search" href="search.html" /><link rel="next" title="API" href="api.html" /><link rel="prev" title="Installation" href="installation.html" />

    <meta name="generator" content="sphinx-4.4.0, furo 2022.01.02"/>
        <title>Usage - php7-sapnwrfc 2.0.0-beta3 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo.css?digest=df49af52631e7917044a9c21a57f7b83170a6dd0" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo-extensions.css?digest=fade93df149f7c5fedb3ff897f799dc7d283b420" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  body[data-theme="dark"] {
    --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
  }
  @media (prefers-color-scheme: dark) {
    body:not([data-theme="light"]) {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
  }
</style></head>
  <body>
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
      <path stroke="none" d="M0 0h24v24H0z" />
      <line x1="4" y1="6" x2="20" y2="6" />
      <line x1="10" y1="12" x2="20" y2="12" />
      <line x1="6" y1="18" x2="20" y2="18" />
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="index.html"><div class="brand">php7-sapnwrfc 2.0.0-beta3 documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="index.html">
  
  
  <span class="sidebar-brand-text">php7-sapnwrfc 2.0.0-beta3 documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="search.html" role="search">
  <input class="sidebar-search" placeholder=Search name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">API</a></li>
<li class="toctree-l1"><a class="reference internal" href="building.html">Building from source</a></li>
</ul>

</div>
</div>
      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <div class="content-icon-container">
          <div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <section id="usage">
<h1>Usage<a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h1>
<p>This guide describes commonly used functions of the <code class="docutils literal notranslate"><span class="pre">php7-sapnwrfc</span></code> extension.
For a more detailed overview of available methods, refer to the <a class="reference internal" href="api.html"><span class="doc">API overview</span></a>.</p>
<p>For getting started right away, refer to the <a class="reference internal" href="introduction.html#quick-start"><span class="std std-ref">Quick start</span></a>.</p>
<section id="connecting-to-a-sap-system">
<h2>Connecting to a SAP system<a class="headerlink" href="#connecting-to-a-sap-system" title="Permalink to this headline">¶</a></h2>
<p>To connect to a SAP system, we create a new instance of <code class="docutils literal notranslate"><span class="pre">SAPNWRFC\Connection</span></code>,
passing connection parameters:</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>
<span class="nv">$parameters</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">'ashost'</span> <span class="o">=&gt;</span> <span class="s1">'my.sap.system.local'</span><span class="p">,</span>
    <span class="s1">'sysnr'</span>  <span class="o">=&gt;</span> <span class="s1">'00'</span><span class="p">,</span>
    <span class="s1">'client'</span> <span class="o">=&gt;</span> <span class="s1">'123'</span><span class="p">,</span>
    <span class="s1">'user'</span> <span class="o">=&gt;</span> <span class="s1">'DEMO'</span><span class="p">,</span>
    <span class="s1">'passwd'</span> <span class="o">=&gt;</span> <span class="s1">'XXXX'</span><span class="p">,</span>
    <span class="c1">// if you need to connect through saprouter, uncomment the following line</span>
    <span class="c1">//'saprouter' =&gt; '/H/my.saprouter.local/H/',</span>
<span class="p">];</span>

<span class="c1">// connect</span>
<span class="nv">$connection</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">SAPNWRFC\Connection</span><span class="p">(</span><span class="nv">$parameters</span><span class="p">);</span>

<span class="c1">// do work here</span>

<span class="c1">// close the connection</span>
<span class="nv">$connection</span><span class="o">-&gt;</span><span class="na">close</span><span class="p">();</span>
</pre></div>
</div>
<p>If the connection attempt fails, a <code class="docutils literal notranslate"><span class="pre">SAPNWRFC\ConnectionException</span></code> is thrown
with details about the error.</p>
<p>We can also use a <code class="docutils literal notranslate"><span class="pre">sapnwrfc.ini</span></code> file to specify connection details. See
<code class="docutils literal notranslate"><span class="pre">SAPNWRFC\Connection::setIniPath($path)</span></code> and <code class="docutils literal notranslate"><span class="pre">SAPNWRFC\Connection::reloadIniFile()</span></code>
in the <a class="reference internal" href="api.html"><span class="doc">API overview</span></a> for details.</p>
<p>For available connection parameters refer to the <a class="reference external" href="https://help.sap.com/viewer/753088fc00704d0a80e7fbd6803c8adb/7.5.9/en-US/48ce50e418d3424be10000000a421937.html">sapnwrfc.ini parameter overview</a>.</p>
<p>After we are done using the connection, it is recommended to close the connection
using <code class="docutils literal notranslate"><span class="pre">SAPNWRFC\Connection::close()</span></code>.</p>
<section id="connection-options">
<h3>Connection options<a class="headerlink" href="#connection-options" title="Permalink to this headline">¶</a></h3>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.2.0.</span></p>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">SAPNWRFC\Connection</span></code> takes a second (optional) parameter specifying options for the connection.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="nv">$parameters</span> <span class="o">=</span> <span class="p">[</span> <span class="cm">/* &lt;...&gt; */</span> <span class="p">];</span>

<span class="nv">$options</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">'use_function_desc_cache'</span> <span class="o">=&gt;</span> <span class="k">false</span><span class="p">,</span>
<span class="p">];</span>

<span class="nv">$connection</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">SAPNWRFC\Connection</span><span class="p">(</span><span class="nv">$parameters</span><span class="p">,</span> <span class="nv">$options</span><span class="p">);</span>
</pre></div>
</div>
<p>The following options are available:</p>
<dl>
<dt>use_function_desc_cache</dt><dd><p>If set to <code class="docutils literal notranslate"><span class="pre">false</span></code> the local function desc cache is cleared before looking up a function
using <code class="docutils literal notranslate"><span class="pre">Connection::getFunction()</span></code>.
This can be useful if a function module signature changes in the backend while a script
is still running. If the script continues to use the old (cached) function description
this will result in garbage/missing values.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Setting this option to <code class="docutils literal notranslate"><span class="pre">false</span></code> can result in degraded performance as the
function description has to be fetched from the backend every time <code class="docutils literal notranslate"><span class="pre">Connection::getFunction()</span></code>
is called.</p>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p>See <a class="reference internal" href="#manually-clearing-function-desc-cache"><span class="std std-ref">Manually clearing the function module description cache</span></a> for a way to clear the cache for individual
function modules.</p>
</div>
<p><em>Default:</em> <code class="docutils literal notranslate"><span class="pre">true</span></code></p>
</dd>
</dl>
</section>
<section id="retrieving-a-sso-ticket">
<h3>Retrieving a SSO ticket<a class="headerlink" href="#retrieving-a-sso-ticket" title="Permalink to this headline">¶</a></h3>
<p>A SSO ticket can be retrieved from an existing connection using <code class="docutils literal notranslate"><span class="pre">SAPNWRFC\Connection::getSSOTicket()</span></code>:</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="c1">// $connection is an existing connection with parameter GETSSO2=1</span>

<span class="nv">$ssoTicket</span> <span class="o">=</span> <span class="nv">$connection</span><span class="o">-&gt;</span><span class="na">getSSOTicket</span><span class="p">();</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<dl class="simple">
<dt>For this to work, the following requirements must be met:</dt><dd><ul class="simple">
<li><p>The connection must have been opened with parameter <code class="docutils literal notranslate"><span class="pre">GETSSO2=1</span></code></p></li>
<li><p>The profile parameter <code class="docutils literal notranslate"><span class="pre">login/create_sso2_ticket</span></code> must be set to a value different from <code class="docutils literal notranslate"><span class="pre">0</span></code> in the backend.</p></li>
<li><p>The used SDK version must be 7.50.1 or later.</p></li>
</ul>
</dd>
</dl>
</div>
</section>
</section>
<section id="calling-remote-function-modules">
<h2>Calling remote function modules<a class="headerlink" href="#calling-remote-function-modules" title="Permalink to this headline">¶</a></h2>
<section id="looking-up-the-function-module">
<h3>Looking up the function module<a class="headerlink" href="#looking-up-the-function-module" title="Permalink to this headline">¶</a></h3>
<p>Before we can call a remote function module, we have to lookup the desired
function module to retrieve a <code class="docutils literal notranslate"><span class="pre">SAPNWRFC\RemoteFunction</span></code> object. This is accomplished
with the <code class="docutils literal notranslate"><span class="pre">SAPNWRFC\Connection::getFunction($functionName)</span></code> method. We simply pass
the name of the remote function module:</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="nv">$remoteFunction</span> <span class="o">=</span> <span class="nv">$connection</span><span class="o">-&gt;</span><span class="na">getFunction</span><span class="p">(</span><span class="s1">'RFC_PING'</span><span class="p">);</span>
</pre></div>
</div>
<p>If the lookup is successful, an object of type <code class="docutils literal notranslate"><span class="pre">SAPNWRFC\RemoteFunction</span></code> is returned
which can be used for invoking the function.</p>
<p>If the function lookup fails, a <code class="docutils literal notranslate"><span class="pre">SAPNWRFC\FunctionCallException</span></code> is thrown.</p>
</section>
<section id="calling-the-function-module">
<h3>Calling the function module<a class="headerlink" href="#calling-the-function-module" title="Permalink to this headline">¶</a></h3>
<p>After we have retrieved a <code class="docutils literal notranslate"><span class="pre">SAPNWRFC\RemoteFunction</span></code> object, we can invoke
the function module by using its <code class="docutils literal notranslate"><span class="pre">invoke()</span></code> method.</p>
<p>To invoke the function module <code class="docutils literal notranslate"><span class="pre">RFC_PING</span></code>, we can simply call <code class="docutils literal notranslate"><span class="pre">invoke()</span></code>
without parameters.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="nv">$returnValue</span> <span class="o">=</span> <span class="nv">$remoteFunction</span><span class="o">-&gt;</span><span class="na">invoke</span><span class="p">();</span>
</pre></div>
</div>
<p>If the function module returns parameters, <code class="docutils literal notranslate"><span class="pre">invoke()</span></code> returns them. On any
errors, a <code class="docutils literal notranslate"><span class="pre">SAPNWRFC\FunctionCallException</span></code> is thrown.</p>
</section>
<section id="parameters-and-return-values">
<h3>Parameters and return values<a class="headerlink" href="#parameters-and-return-values" title="Permalink to this headline">¶</a></h3>
<p>In practice, most of the remote function modules will require us to pass
parameters and/or will return parameters after invocation.</p>
<p>Passing parameters is possible using the <code class="docutils literal notranslate"><span class="pre">$parameters</span></code> array of the remote
function’s <code class="docutils literal notranslate"><span class="pre">invoke()</span></code> method. Parameters are passed as arrays, with the
key being the name of the parameter and the value the value to pass.</p>
<p>The same is true for return values. If a remote function module returns parameters,
they will be available in the array returned from <code class="docutils literal notranslate"><span class="pre">invoke()</span></code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>ABAP function modules know four different types of parameters:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">IMPORT</span></code>: set by the client.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">EXPORT</span></code>: set by the server.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CHANGING</span></code>: set by the client and can be modified by the server.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">TABLE</span></code>: set by the client and can be modified by the server.</p></li>
</ul>
</div>
<p>To call a function module <code class="docutils literal notranslate"><span class="pre">STFC_CHANGING</span></code> that requires input parameters as well
as returns parameters to the caller, we can do as follows:</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="nv">$function</span> <span class="o">=</span> <span class="nv">$connection</span><span class="o">-&gt;</span><span class="na">getFunction</span><span class="p">(</span><span class="s1">'STFC_CHANGING'</span><span class="p">);</span>
<span class="nv">$result</span> <span class="o">=</span> <span class="nv">$function</span><span class="o">-&gt;</span><span class="na">invoke</span><span class="p">([</span>
    <span class="s1">'START_VALUE'</span> <span class="o">=&gt;</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s1">'COUNTER'</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span>
<span class="p">]);</span>

<span class="cm">/*</span>
<span class="cm">$result looks like this:</span>

<span class="cm">array(2) {</span>
<span class="cm">  ["COUNTER"] =&gt; int(2)</span>
<span class="cm">  ["RESULT"] =&gt; int(1)</span>
<span class="cm">}</span>
<span class="cm">*/</span>
</pre></div>
</div>
<p>The types of the parameters and return values are mapped to standard PHP types.</p>
</section>
<section id="parameter-type-mappings">
<h3>Parameter type mappings<a class="headerlink" href="#parameter-type-mappings" title="Permalink to this headline">¶</a></h3>
<p>Remote function modules execute ABAP code and therefor use ABAB data types. This extension
maps between RFC data types and builtin PHP data types as follows:</p>
<div class="table-wrapper"><table class="docutils align-default">
<colgroup>
<col style="width: 8%"/>
<col style="width: 8%"/>
<col style="width: 8%"/>
<col style="width: 39%"/>
<col style="width: 37%"/>
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>ABAP type</p></th>
<th class="head"><p>RFC type</p></th>
<th class="head"><p>PHP type</p></th>
<th class="head"><p>Meaning</p></th>
<th class="head"><p>Notes</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>C</p></td>
<td><p>CHAR</p></td>
<td><p>string</p></td>
<td><p>Text field (alphanumeric characters)</p></td>
<td><p>right-padded with blanks; see <code class="docutils literal notranslate"><span class="pre">rtrim</span></code> option</p></td>
</tr>
<tr class="row-odd"><td><p>D</p></td>
<td><p>DATE</p></td>
<td><p>string</p></td>
<td><p>Date field (format: YYYYMMDD)</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>T</p></td>
<td><p>TIME</p></td>
<td><p>string</p></td>
<td><p>Time field (format: HHMMSS)</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>X</p></td>
<td><p>BYTE</p></td>
<td><p>string</p></td>
<td><p>Hexadecimal field</p></td>
<td><p>use <code class="docutils literal notranslate"><span class="pre">hex2bin()</span></code> to convert to binary</p></td>
</tr>
<tr class="row-even"><td><p>N</p></td>
<td><p>NUM</p></td>
<td><p>string</p></td>
<td><p>Numeric text field</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>STRING</p></td>
<td><p>STRING</p></td>
<td><p>string</p></td>
<td><p>String (dynamic length)</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>XSTRING</p></td>
<td><p>BYTE</p></td>
<td><p>string</p></td>
<td><p>Hexadecimal string (dynamic length)</p></td>
<td><p>use <code class="docutils literal notranslate"><span class="pre">hex2bin()</span></code> to convert to binary</p></td>
</tr>
<tr class="row-odd"><td><p>I</p></td>
<td><p>INT</p></td>
<td><p>integer</p></td>
<td><p>Integer</p></td>
<td><p>INT1 and INT2 are also mapped to integer</p></td>
</tr>
<tr class="row-even"><td><p>INT8</p></td>
<td><p>INT8</p></td>
<td><p>integer</p></td>
<td><p>Integer (8 bytes)</p></td>
<td><p>Only available on 64bit systems.</p></td>
</tr>
<tr class="row-odd"><td><p>P</p></td>
<td><p>BCD</p></td>
<td><p>string</p></td>
<td><p>Packed number / BCD</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>F</p></td>
<td><p>FLOAT</p></td>
<td><p>double</p></td>
<td><p>Floating point number</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>DECFLOAT16</p></td>
<td><p>DECF16</p></td>
<td><p>string</p></td>
<td><p>Decimal floating point number</p></td>
<td><p>Uses string to prevent rounding errors.</p></td>
</tr>
<tr class="row-even"><td><p>DECFLOAT34</p></td>
<td><p>DECF34</p></td>
<td><p>string</p></td>
<td><p>Decimal floating point number</p></td>
<td><p>Uses string to prevent rounding errors.</p></td>
</tr>
</tbody>
</table></div>
<p>Additionally, there are also tables and structures:</p>
<ul class="simple">
<li><p>A structure is mapped to an associative array, with the keys being the field names
and the values the field values.</p></li>
<li><p>A table is an array of structures.</p></li>
</ul>
</section>
<section id="passing-options-when-calling-function-modules">
<h3>Passing options when calling function modules<a class="headerlink" href="#passing-options-when-calling-function-modules" title="Permalink to this headline">¶</a></h3>
<p>When calling function modules using <code class="docutils literal notranslate"><span class="pre">RemoteFunction::invoke()</span></code> a second parameter can
be passed specifying options for the function call.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="c1">// ...</span>
<span class="nv">$options</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">'rtrim'</span> <span class="o">=&gt;</span> <span class="k">true</span>
<span class="p">];</span>

<span class="nv">$function</span><span class="o">-&gt;</span><span class="na">invoke</span><span class="p">(</span><span class="nv">$parameters</span><span class="p">,</span> <span class="nv">$options</span><span class="p">);</span>
</pre></div>
</div>
<p>The following options are available:</p>
<dl>
<dt>rtrim</dt><dd><p>In ABAP, there are two ways to store strings: as fixed length string type C or as dynamic
length type STRING. When using type C strings are right-padded with blanks, if the string
is shorter than the predefined length. To unify the extensions behaviour with strings, the
<code class="docutils literal notranslate"><span class="pre">rtrim</span></code> option is available. If set to <code class="docutils literal notranslate"><span class="pre">true</span></code>, type C strings are right-trimmed before
being returned.</p>
<p><em>Default:</em> <code class="docutils literal notranslate"><span class="pre">false</span></code></p>
</dd>
</dl>
</section>
<section id="activating-deactivating-parameters">
<h3>Activating/Deactivating parameters<a class="headerlink" href="#activating-deactivating-parameters" title="Permalink to this headline">¶</a></h3>
<p>The <em>SAP NW RFC library</em> supports the activation and deactivation of parameters
of a function module. This is especially useful if a function module has a lot of
(possibly big) return values that you are not interested in.</p>
<p>To activate or deactivate a parameter, we call the method
<code class="docutils literal notranslate"><span class="pre">SAPNWRFC\RemoteFunction::setParameterActive($parameterName,</span> <span class="pre">$isActive)</span></code>
on the remote function object. We can use <code class="docutils literal notranslate"><span class="pre">SAPNWRFC\RemoteFunction::isParameterActive($parameterName)</span></code>
to check if a parameter is active or not.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="nv">$function</span> <span class="o">=</span> <span class="nv">$connection</span><span class="o">-&gt;</span><span class="na">getFunction</span><span class="p">(</span><span class="s1">'STFC_STRUCTURE'</span><span class="p">);</span>

<span class="nv">$function</span><span class="o">-&gt;</span><span class="na">setParameterActive</span><span class="p">(</span><span class="s1">'IMPORTSTRUCT'</span><span class="p">,</span> <span class="k">false</span><span class="p">);</span>
<span class="nv">$function</span><span class="o">-&gt;</span><span class="na">setParameterActive</span><span class="p">(</span><span class="s1">'RFCTABLE'</span><span class="p">,</span> <span class="k">false</span><span class="p">);</span>

<span class="nv">$function</span><span class="o">-&gt;</span><span class="na">isParameterActive</span><span class="p">(</span><span class="s1">'IMPORTSTRUCT'</span><span class="p">);</span> <span class="c1">// returns false</span>

<span class="c1">// we don't need to pass parameters when invoking the function module,</span>
<span class="c1">// as we deactivated all of them</span>
<span class="nv">$result</span> <span class="o">=</span> <span class="nv">$function</span><span class="o">-&gt;</span><span class="na">invoke</span><span class="p">([]);</span>

<span class="c1">// $result will not contain the 'RFCTABLE' parameter</span>

<span class="nv">$function</span><span class="o">-&gt;</span><span class="na">setParameterActive</span><span class="p">(</span><span class="s1">'RFCTABLE'</span><span class="p">,</span> <span class="k">true</span><span class="p">);</span>
<span class="nv">$function</span><span class="o">-&gt;</span><span class="na">isParameterActive</span><span class="p">(</span><span class="s1">'IMPORTSTRUCT'</span><span class="p">);</span> <span class="c1">// returns true</span>

<span class="c1">// we need to pass the 'RFC_TABLE' parameter now</span>
<span class="nv">$result</span> <span class="o">=</span> <span class="nv">$function</span><span class="o">-&gt;</span><span class="na">invoke</span><span class="p">([</span>
    <span class="s1">'RFCTABLE'</span> <span class="o">=&gt;</span> <span class="p">[],</span>
<span class="p">]);</span>
</pre></div>
</div>
</section>
<section id="manually-clearing-the-function-module-description-cache">
<span id="manually-clearing-function-desc-cache"></span><h3>Manually clearing the function module description cache<a class="headerlink" href="#manually-clearing-the-function-module-description-cache" title="Permalink to this headline">¶</a></h3>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.3.0.</span></p>
</div>
<p>A call to <code class="docutils literal notranslate"><span class="pre">Connection::getFunction()</span></code> uses a local cache of the function module
descriptions to speed up the lookup. This usually is desired behaviour but can
lead to unexpected results when the function module signature changes in the
backend while a script is still running (missing/garbage return values, etc.).</p>
<p>In addition to setting the <code class="docutils literal notranslate"><span class="pre">use_function_desc_cache</span></code> option on the connection
level the cache can also be cleared for individual function modules using the
function <code class="docutils literal notranslate"><span class="pre">\SAPNWRFC\clearFunctionDescCache($functionName,</span> <span class="pre">$repositoryId</span> <span class="pre">=</span> <span class="pre">null)</span></code>.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="nx">\SAPNWRFC\clearFunctionDescCache</span><span class="p">(</span><span class="s1">'STFC_STRUCTURE'</span><span class="p">);</span>
<span class="c1">// or using the system ID</span>
<span class="nx">\SAPNWRFC\clearFunctionDescCache</span><span class="p">(</span><span class="s1">'STFC_STRUCTURE'</span><span class="p">,</span> <span class="s1">'X01'</span><span class="p">);</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Manually clearing the function desc cache does not affect already
existing <code class="docutils literal notranslate"><span class="pre">RemoteFunction</span></code> objects:</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="nv">$oldFn</span> <span class="o">=</span> <span class="nv">$connection</span><span class="o">-&gt;</span><span class="na">getFunction</span><span class="p">(</span><span class="s1">'STFC_STRUCTURE'</span><span class="p">);</span>
<span class="nx">\SAPNWRFC\clearFunctionDescCache</span><span class="p">(</span><span class="s1">'STFC_STRUCTURE'</span><span class="p">);</span>
<span class="nv">$newFn</span> <span class="o">=</span> <span class="nv">$connection</span><span class="o">-&gt;</span><span class="na">getFunction</span><span class="p">(</span><span class="s1">'STFC_STRUCTURE'</span><span class="p">);</span>

<span class="c1">// $oldFn still uses the old function description!</span>
</pre></div>
</div>
</div>
</section>
<section id="function-module-details">
<h3>Function module details<a class="headerlink" href="#function-module-details" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">SAPNWRFC\RemoteFunction</span></code> object defines a <code class="docutils literal notranslate"><span class="pre">name</span></code> property containing
the name of the function module it represents.</p>
<p>Additionally, a property for each parameter of the function module is defined
on the object that can be used to get detailed information about the parameter.</p>
</section>
</section>
<section id="trace-levels">
<h2>Trace levels<a class="headerlink" href="#trace-levels" title="Permalink to this headline">¶</a></h2>
<p>The <em>SAP NW RFC library</em> allows the creation of trace files to troubleshoot
connection and/or function call problems.</p>
<p>We can set the desired trace level via the <code class="docutils literal notranslate"><span class="pre">trace</span></code> parameter when
establishing the connection or change it at any time using the
<code class="docutils literal notranslate"><span class="pre">SAPNWRFC\Connection::setTraceLevel($level)</span></code> method.</p>
<p>The extension defines constants on the <code class="docutils literal notranslate"><span class="pre">SAPNWRFC\Connection</span></code> class
for the four trace levels (from least to most verbose): <code class="docutils literal notranslate"><span class="pre">TRACE_LEVEL_OFF</span></code>,
<code class="docutils literal notranslate"><span class="pre">TRACE_LEVEL_BRIEF</span></code>, <code class="docutils literal notranslate"><span class="pre">TRACE_LEVEL_VERBOSE</span></code>, <code class="docutils literal notranslate"><span class="pre">TRACE_LEVEL_FULL</span></code>.</p>
<p>Additionally, we can set the directory for the generated trace file
using <code class="docutils literal notranslate"><span class="pre">SAPNWRFC\Connection::setTraceDir($path)</span></code>. The default location
for the trace file is the current working directory.</p>
</section>
<section id="getting-the-version">
<h2>Getting the version<a class="headerlink" href="#getting-the-version" title="Permalink to this headline">¶</a></h2>
<p>The extension provides the methods <code class="docutils literal notranslate"><span class="pre">SAPNWRFC\Connection::version()</span></code> and
<code class="docutils literal notranslate"><span class="pre">SAPNWRFC\Connection::rfcVersion()</span></code> for getting the extension version
and the RFC SDK version in use.</p>
<p>Both methods return a string formatted as <code class="docutils literal notranslate"><span class="pre">MAJOR.MINOR.PATCH</span></code> (for example 1.1.3);</p>
</section>
<section id="exceptions">
<h2>Exceptions<a class="headerlink" href="#exceptions" title="Permalink to this headline">¶</a></h2>
<p>If an error occurs during any interaction, an exception is thrown with error details.
Currently, there are two exception classes:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">SAPNWRFC\ConnectionException</span></code> for any errors that concern the connection itself.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">SAPNWRFC\FunctionCallException</span></code> for errors that stem from function module invocations.</p></li>
</ul>
<p>Both exception classes extend the base exception class <code class="docutils literal notranslate"><span class="pre">SAPNWRFC\Exception</span></code>, which
adds an additional <code class="docutils literal notranslate"><span class="pre">getErrorInfo()</span></code> method to the standard methods and properties
provided by <code class="docutils literal notranslate"><span class="pre">RuntimeException</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">getErrorInfo()</span></code> returns an array with detailed error information and contains
at least the keys <code class="docutils literal notranslate"><span class="pre">code</span></code>, <code class="docutils literal notranslate"><span class="pre">key</span></code> and <code class="docutils literal notranslate"><span class="pre">message</span></code>.</p>
<p>Depending on the type of error, the following additional keys might be available
with detailed information: <code class="docutils literal notranslate"><span class="pre">abapMsgClass</span></code>, <code class="docutils literal notranslate"><span class="pre">abapMsgType</span></code>, <code class="docutils literal notranslate"><span class="pre">abapMsgNumber</span></code>,
<code class="docutils literal notranslate"><span class="pre">abapMsgV1</span></code>, <code class="docutils literal notranslate"><span class="pre">abapMsgV2</span></code>, <code class="docutils literal notranslate"><span class="pre">abapMsgV3</span></code>, <code class="docutils literal notranslate"><span class="pre">abapMsgV4</span></code>.</p>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="api.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">API</div>
              </div>
              <svg><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="installation.html">
              <svg><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Installation</div>
                
              </div>
            </a>
        </div>

        <div class="related-information">
              Copyright &#169; 2016 - 2021 Gregor Kralik |
          Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
          <a href="https://github.com/pradyunsg/furo">Furo theme</a>.
            | <a class="muted-link" href="_sources/usage.rst.txt"
               rel="nofollow">
              Show Source
            </a>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            Contents
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Usage</a><ul>
<li><a class="reference internal" href="#connecting-to-a-sap-system">Connecting to a SAP system</a><ul>
<li><a class="reference internal" href="#connection-options">Connection options</a></li>
<li><a class="reference internal" href="#retrieving-a-sso-ticket">Retrieving a SSO ticket</a></li>
</ul>
</li>
<li><a class="reference internal" href="#calling-remote-function-modules">Calling remote function modules</a><ul>
<li><a class="reference internal" href="#looking-up-the-function-module">Looking up the function module</a></li>
<li><a class="reference internal" href="#calling-the-function-module">Calling the function module</a></li>
<li><a class="reference internal" href="#parameters-and-return-values">Parameters and return values</a></li>
<li><a class="reference internal" href="#parameter-type-mappings">Parameter type mappings</a></li>
<li><a class="reference internal" href="#passing-options-when-calling-function-modules">Passing options when calling function modules</a></li>
<li><a class="reference internal" href="#activating-deactivating-parameters">Activating/Deactivating parameters</a></li>
<li><a class="reference internal" href="#manually-clearing-the-function-module-description-cache">Manually clearing the function module description cache</a></li>
<li><a class="reference internal" href="#function-module-details">Function module details</a></li>
</ul>
</li>
<li><a class="reference internal" href="#trace-levels">Trace levels</a></li>
<li><a class="reference internal" href="#getting-the-version">Getting the version</a></li>
<li><a class="reference internal" href="#exceptions">Exceptions</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/scripts/furo.js"></script>
    </body>
</html>